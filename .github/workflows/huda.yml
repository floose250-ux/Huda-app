name: HUDA-PRO-FINAL-APK-V71
on: [push, workflow_dispatch]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
      
      # 1. تنظيف وبناء الهيكل السليم (اللي نجحنا فيه قبل شوي)
      - run: |
          rm -rf lib android ios assets pubspec.yaml
          flutter create . --org com.huda.app.final --project-name huda_pro --overwrite
          mkdir -p lib/screens
          
          # كود شاشة الفاتحة (التي نجحت معك سابقاً)
          cat <<'EOF' > lib/main.dart
          import 'package:flutter/material.dart';
          import 'screens/quran.dart';
          void main() => runApp(const MaterialApp(home: QuranPage(), debugShowCheckedModeBanner: false));
          EOF

          cat <<'EOF' > lib/screens/quran.dart
          import 'package:flutter/material.dart';
          class QuranPage extends StatelessWidget {
            const QuranPage({super.key});
            @override
            Widget build(BuildContext context) => Scaffold(
              backgroundColor: const Color(0xFF000D0D),
              appBar: AppBar(title: const Text('المصحف الشريف'), backgroundColor: const Color(0xFF001F1F)),
              body: const ListTile(title: Text('سورة الفاتحة', style: TextStyle(color: Colors.white))),
            );
          }
          EOF

      # 2. أمر البناء الفعلي (هذا اللي كان ناقصك)
      - run: flutter pub get
      - run: flutter build apk --release
      
      # 3. أمر إظهار رابط التحميل (Artifacts)
      - uses: actions/upload-artifact@v4
        with:
          name: HUDA-PRO-APK-V71
          path: build/app/outputs/flutter-apk/app-release.apk
