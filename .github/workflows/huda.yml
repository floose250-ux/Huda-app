name: HUDA-ULTIMATE-PRO-V38
on: [push, workflow_dispatch]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
      
      # إصلاح ملفات النظام
      - run: flutter create . --org com.huda.app.pro --project-name huda_pro_app --overwrite
      
      # حقن الكود الشامل (المصحف + الأذكار + التفسير)
      - run: |
          mkdir -p lib
          cat <<EOF > lib/main.dart
          import 'package:flutter/material.dart';
          void main() => runApp(const MaterialApp(home: HudaProHome(), debugShowCheckedModeBanner: false));
          
          class HudaProHome extends StatelessWidget {
            const HudaProHome({super.key});
            @override Widget build(BuildContext context) {
              return Scaffold(
                backgroundColor: const Color(0xFF000D0D),
                appBar: AppBar(title: const Text('هدى برو - الموسوعة الشاملة'), backgroundColor: Colors.teal.shade900, centerTitle: true),
                body: GridView.count(
                  crossAxisCount: 2, padding: const EdgeInsets.all(15), mainAxisSpacing: 15, crossAxisSpacing: 15,
                  children: [
                    _card(context, 'المصحف الشريف', Icons.menu_book, Colors.amber, const QuranPage()),
                    _card(context, 'موسوعة الأذكار', Icons.auto_awesome, Colors.orange, const AzkarCategories()),
                    _card(context, 'اتجاه القبلة', Icons.explore, Colors.redAccent, null),
                    _card(context, 'تحدي الاستغفار', Icons.fingerprint, Colors.tealAccent, null),
                  ],
                ),
              );
            }
            Widget _card(BuildContext c, String t, IconData i, Color clr, Widget? p) => Card(
              color: const Color(0xFF001F1F), shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
              child: InkWell(onTap: () => p != null ? Navigator.push(c, MaterialPageRoute(builder: (c) => p)) : null,
              child: Column(mainAxisAlignment: MainAxisAlignment.center, children: [Icon(i, size: 45, color: clr), Text(t, style: const TextStyle(color: Colors.white, fontWeight: FontWeight.bold))])),
            );
          }

          class QuranPage extends StatelessWidget {
            const QuranPage({super.key});
            @override Widget build(BuildContext context) => Scaffold(
              backgroundColor: const Color(0xFF000D0D),
              appBar: AppBar(title: const Text('المصحف الشريف'), backgroundColor: Colors.teal.shade900),
              body: const Center(child: Text('قائمة السور قيد التحميل...', style: TextStyle(color: Colors.white))),
            );
          }

          class AzkarCategories extends StatelessWidget {
            const AzkarCategories({super.key});
            @override Widget build(BuildContext context) => Scaffold(
              backgroundColor: const Color(0xFF000D0D),
              appBar: AppBar(title: const Text('تصنيفات الأذكار'), backgroundColor: Colors.teal.shade900),
              body: ListView(children: [
                ListTile(leading: const Icon(Icons.wb_sunny, color: Colors.orange), title: const Text('أذكار الصباح', style: TextStyle(color: Colors.white)), onTap: () {}),
                ListTile(leading: const Icon(Icons.nightlight_round, color: Colors.blueGrey), title: const Text('أذكار المساء', style: TextStyle(color: Colors.white)), onTap: () {}),
              ]),
            );
          }
          EOF

      - run: flutter pub get
      - run: flutter build apk --release
      
      - uses: actions/upload-artifact@v4
        with:
          name: HUDA-PRO-V38-ULTIMATE
          path: build/app/outputs/flutter-apk/app-release.apk
