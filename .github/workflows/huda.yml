name: HUDA-MASTER-BUILD-V50
on: [push, workflow_dispatch]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
      
      # الخطوة الأهم: بناء ملفات الـ Gradle المفقودة لإصلاح الخطأ
      - run: flutter create . --org com.huda.pro.final --project-name huda_pro --overwrite
      
      # إنشاء المجلدات لتوزيع الأقسام
      - run: |
          mkdir -p lib/screens
          mkdir -p assets
          
          # 1. ملف المحرك (main.dart)
          cat <<'EOF' > lib/main.dart
          import 'package:flutter/material.dart';
          import 'screens/quran.dart';

          void main() => runApp(const MaterialApp(home: QuranPage(), debugShowCheckedModeBanner: false));
          EOF

          # 2. ملف المصحف الشامل (quran.dart) - يحتوي على التفسير والإعراب
          cat <<'EOF' > lib/screens/quran.dart
          import 'package:flutter/material.dart';
          class QuranPage extends StatelessWidget {
            const QuranPage({super.key});
            @override
            Widget build(BuildContext context) => Scaffold(
              backgroundColor: const Color(0xFF000D0D),
              appBar: AppBar(title: const Text('المصحف الشريف'), backgroundColor: const Color(0xFF001F1F)),
              body: ListView(children: [
                ListTile(
                  leading: const CircleAvatar(child: Text('1')),
                  title: const Text('سورة الفاتحة', style: TextStyle(color: Colors.white)),
                  onTap: () => Navigator.push(context, MaterialPageRoute(builder: (c) => const SuraDetail())),
                ),
              ]),
            );
          }

          class SuraDetail extends StatelessWidget {
            const SuraDetail({super.key});
            @override
            Widget build(BuildContext context) => Scaffold(
              backgroundColor: const Color(0xFFF5F5DC),
              appBar: AppBar(title: const Text('الفاتحة'), backgroundColor: Colors.teal.shade900),
              body: ListView(padding: const EdgeInsets.all(20), children: [
                _verse(context, "بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيمِ (1)", "تفسير: نبدأ مستعينين بالله..", "إعراب: الباء حرف جر.."),
                _verse(context, "الْحَمْدُ لِلَّهِ رَبِّ الْعَالَمِينَ (2)", "تفسير: الثناء لله رب كل شيء..", "إعراب: الحمدُ مبتدأ مرفوع.."),
              ]),
            );
            Widget _verse(BuildContext c, String v, String t, String i) => InkWell(
              onTap: () => showModalBottomSheet(context: c, builder: (c) => DefaultTabController(length: 2, child: Column(children: [
                const TabBar(tabs: [Tab(text: 'التفسير'), Tab(text: 'الإعراب')], labelColor: Colors.teal),
                Expanded(child: TabBarView(children: [Center(child: Text(t)), Center(child: Text(i))]))
              ]))),
              child: Padding(padding: const EdgeInsets.all(15), child: Text(v, textAlign: TextAlign.center, style: const TextStyle(fontSize: 22, color: Colors.black, fontWeight: FontWeight.bold))),
            );
          }
          EOF

          # 3. تحديث ملف الخصائص (pubspec.yaml)
          cat <<'EOF' > pubspec.yaml
          name: huda_pro
          environment:
            sdk: ">=3.0.0 <4.0.0"
          dependencies:
            flutter:
              sdk: flutter
          flutter:
            uses-material-design: true
          EOF

      - run: flutter pub get
      - run: flutter build apk --release
      
      - uses: actions/upload-artifact@v4
        with:
          name: HUDA-FINAL-PRO-APK
          path: build/app/outputs/flutter-apk/app-release.apk
