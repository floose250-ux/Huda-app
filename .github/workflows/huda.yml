name: HUDA-MODULAR-FINAL-V48
on: [push, workflow_dispatch]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
      
      - run: flutter create . --org com.huda.pro.modular --project-name huda_pro --overwrite
      
      - run: |
          mkdir -p lib/screens
          
          # 1. ملف المحرك الرئيسي (التنقل بين الأقسام)
          cat <<'EOF' > lib/main.dart
          import 'package:flutter/material.dart';
          import 'screens/quran.dart';
          import 'screens/tools.dart';
          import 'screens/lineage.dart';
          import 'screens/kids.dart';
          import 'screens/haram.dart';

          void main() => runApp(const MaterialApp(home: MainNav(), debugShowCheckedModeBanner: false));

          class MainNav extends StatefulWidget {
            const MainNav({super.key});
            @override _MainNavState createState() => _MainNavState();
          }

          class _MainNavState extends State<MainNav> {
            int _idx = 0;
            final List<Widget> _screens = [const HomeScreen(), const QuranPage(), const LineagePage(), const HaramPage(), const ToolsPage(), const KidsPage()];
            @override
            Widget build(BuildContext context) => Scaffold(
              body: _screens[_idx],
              bottomNavigationBar: BottomNavigationBar(
                currentIndex: _idx,
                onTap: (i) => setState(() => _idx = i),
                type: BottomNavigationBarType.fixed,
                backgroundColor: const Color(0xFF001F1F),
                selectedItemColor: Colors.amber,
                unselectedItemColor: Colors.white60,
                items: const [
                  BottomNavigationBarItem(icon: Icon(Icons.home), label: 'الرئيسية'),
                  BottomNavigationBarItem(icon: Icon(Icons.menu_book), label: 'المصحف'),
                  BottomNavigationBarItem(icon: Icon(Icons.people), label: 'الأنساب'),
                  BottomNavigationBarItem(icon: Icon(Icons.warning), label: 'المحرمات'),
                  BottomNavigationBarItem(icon: Icon(Icons.apps), label: 'الأدوات'),
                  BottomNavigationBarItem(icon: Icon(Icons.child_care), label: 'البراعم'),
                ],
              ),
            );
          }

          class HomeScreen extends StatelessWidget {
            const HomeScreen({super.key});
            @override
            Widget build(BuildContext context) => const Scaffold(backgroundColor: Color(0xFF000D0D), body: Center(child: Icon(Icons.mosque, size: 100, color: Colors.teal)));
          }
          EOF

          # 2. ملف المصحف الشريف (الفهرس + الآيات + التفسير + الإعراب)
          cat <<'EOF' > lib/screens/quran.dart
          import 'package:flutter/material.dart';
          class QuranPage extends StatelessWidget {
            const QuranPage({super.key});
            final List<String> surahs = const ['الفاتحة', 'البقرة', 'آل عمران', 'النساء', 'المائدة', 'الأنعام', 'الأعراف', 'الأنفال', 'التوبة', 'يونس', 'هود', 'يوسف', 'الرعد', 'إبراهيم', 'الحجر', 'النحل', 'الإسراء', 'الكهف', 'مريم', 'طه', 'الأنبياء', 'الحج', 'المؤمنون', 'النور', 'الفرقان', 'الشعراء', 'النمل', 'القصص', 'العنكبوت', 'الروم', 'لقمان', 'السجدة', 'الأحزاب', 'سبأ', 'فاطر', 'يس', 'الصافات', 'ص', 'الزمر', 'غافر', 'فصلت', 'الشورى', 'الزخرف', 'الدخان', 'الجاثية', 'الأحقاف', 'محمد', 'الفتح', 'الحجرات', 'ق', 'الذاريات', 'الطور', 'النجم', 'القمر', 'الرحمن', 'الواقعة', 'الحديد', 'المجادلة', 'الحشر', 'الممتحنة', 'الصف', 'الجمعة', 'المنافقون', 'التغابن', 'الطلاق', 'التحريم', 'الملك', 'القلم', 'الحاقة', 'المعارج', 'نوح', 'الجن', 'المزمل', 'المدثر', 'القيامة', 'الإنسان', 'المرسلات', 'النبأ', 'النازعات', 'عبس', 'التكوير', 'الانفطار', 'المطففين', 'الانشقاق', 'البروج', 'الطارق', 'الأعلى', 'الغاشية', 'الفجر', 'البلد', 'الشمس', 'الليل', 'الضحى', 'الشرح', 'التين', 'العلق', 'القدر', 'البينة', 'الزلزلة', 'العاديات', 'القارعة', 'التكاثر', 'العصر', 'الهمزة', 'الفيل', 'قريش', 'الماعون', 'الكوثر', 'الكافرون', 'النصر', 'المسد', 'الإخلاص', 'الفلق', 'الناس'];
            @override
            Widget build(BuildContext context) => Scaffold(
              backgroundColor: const Color(0xFF000D0D),
              appBar: AppBar(title: const Text('فهرس السور'), backgroundColor: const Color(0xFF001F1F)),
              body: ListView.builder(
                itemCount: surahs.length,
                itemBuilder: (c, i) => ListTile(
                  leading: CircleAvatar(child: Text('${i+1}')),
                  title: Text(surahs[i], style: const TextStyle(color: Colors.white)),
                  onTap: () => Navigator.push(context, MaterialPageRoute(builder: (c) => VerseView(name: surahs[i]))),
                ),
              ),
            );
          }

          class VerseView extends StatelessWidget {
            final String name;
            const VerseView({super.key, required this.name});
            @override
            Widget build(BuildContext context) => Scaffold(
              backgroundColor: const Color(0xFFF5F5DC),
              appBar: AppBar(title: Text(name), backgroundColor: Colors.teal.shade900),
              body: ListView(padding: const EdgeInsets.all(20), children: [
                _buildVerse(context, "بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيمِ (1)", "تفسير: نبدأ مستعينين بالله..", "إعراب: الباء حرف جر.."),
                _buildVerse(context, "الْحَمْدُ لِلَّهِ رَبِّ الْعَالَمِينَ (2)", "تفسير: الثناء لله رب كل شيء..", "إعراب: الحمدُ مبتدأ مرفوع.."),
              ]),
            );
            Widget _buildVerse(BuildContext c, String v, String t, String i) => InkWell(
              onTap: () => showModalBottomSheet(context: c, builder: (c) => DefaultTabController(length: 2, child: Column(children: [
                const TabBar(tabs: [Tab(text: 'التفسير'), Tab(text: 'الإعراب')], labelColor: Colors.amber),
                Expanded(child: TabBarView(children: [Center(child: Text(t)), Center(child: Text(i))]))
              ]))),
              child: Padding(padding: const EdgeInsets.all(15), child: Text(v, textAlign: TextAlign.center, style: const TextStyle(fontSize: 22, color: Colors.black, fontWeight: FontWeight.bold))),
            );
          }
          EOF

          # 3. ملف الأنساب والقبائل (العوالق، بني حارث، الصحابة)
          cat <<'EOF' > lib/screens/lineage.dart
          import 'package:flutter/material.dart';
          class LineagePage extends StatelessWidget {
            const LineagePage({super.key});
            @override
            Widget build(BuildContext context) => Scaffold(
              backgroundColor: const Color(0xFF000D0D),
              appBar: AppBar(title: const Text('الأنساب والقبائل العربية')),
              body: ListView(children: const [
                ListTile(title: Text('قبيلة العوالق', style: TextStyle(color: Colors.amber)), subtitle: Text('من قبائل اليمن وشبه الجزيرة العريقة')),
                ListTile(title: Text('بني حارث', style: TextStyle(color: Colors.amber)), subtitle: Text('تاريخ وأعلام القبيلة')),
                ListTile(title: Text('أبو بكر الصديق', style: TextStyle(color: Colors.amber)), subtitle: Text('النسب: بنو تيم - قريش')),
              ]),
            );
          }
          EOF

          # 4. ملف الأدوات (المسبحة + القبلة)
          cat <<'EOF' > lib/screens/tools.dart
          import 'package:flutter/material.dart';
          class ToolsPage extends StatelessWidget {
            const ToolsPage({super.key});
            @override
            Widget build(BuildContext context) => Scaffold(
              backgroundColor: const Color(0xFF000D0D),
              appBar: AppBar(title: const Text('المسبحة والقبلة')),
              body: GridView.count(crossAxisCount: 2, children: const [
                Card(color: Color(0xFF001F1F), child: Column(mainAxisAlignment: MainAxisAlignment.center, children: [Icon(Icons.fingerprint, size: 50, color: Colors.amber), Text('المسبحة')])),
                Card(color: Color(0xFF001F1F), child: Column(mainAxisAlignment: MainAxisAlignment.center, children: [Icon(Icons.explore, size: 50, color: Colors.amber), Text('القبلة')])),
              ]),
            );
          }
          EOF

          # 5. ملف المحرمات (الموثقة بالأدلة)
          cat <<'EOF' > lib/screens/haram.dart
          import 'package:flutter/material.dart';
          class HaramPage extends StatelessWidget {
            const HaramPage({super.key});
            @override
            Widget build(BuildContext context) => Scaffold(
              backgroundColor: const Color(0xFF000D0D),
              appBar: AppBar(title: const Text('تنبيهات شرعية')),
              body: ListView(children: const [
                ExpansionTile(title: Text('الإسبال للرجال', style: TextStyle(color: Colors.redAccent)), children: [Padding(padding: EdgeInsets.all(15), child: Text('قال ﷺ: ما أسفل من الكعبين من الإزار ففي النار (رواه البخاري)'))]),
                ExpansionTile(title: Text('النميمة', style: TextStyle(color: Colors.redAccent)), children: [Padding(padding: EdgeInsets.all(15), child: Text('قال ﷺ: لا يدخل الجنة نمام (متفق عليه)'))]),
              ]),
            );
          }
          EOF

          # 6. ملف براعم الإيمان (ركن الأطفال)
          cat <<'EOF' > lib/screens/kids.dart
          import 'package:flutter/material.dart';
          class KidsPage extends StatelessWidget {
            const KidsPage({super.key});
            @override
            Widget build(BuildContext context) => Scaffold(
              backgroundColor: const Color(0xFF1A001A),
              appBar: AppBar(title: const Text('براعم الإيمان'), backgroundColor: Colors.purple),
              body: const Center(child: Column(mainAxisAlignment: MainAxisAlignment.center, children: [Icon(Icons.child_care, size: 80, color: Colors.pinkAccent), Text('قصص الأنبياء وأخلاق المسلم الصغير')])),
            );
          }
          EOF

      - run: flutter pub get
      - run: flutter build apk --release
      
      - uses: actions/upload-artifact@v4
        with:
          name: HUDA-MODULAR-FINAL-V48
          path: build/app/outputs/flutter-apk/app-release.apk
